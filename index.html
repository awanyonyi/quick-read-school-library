<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Maryland Senior School Library - Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Maryland Library Management System - Borrow books, track your history, and more" />
  <meta name="author" content="Allan Wanyonyi" />

  <!-- Permissions Policy for WebAuthn -->
  <meta http-equiv="Permissions-Policy" content="publickey-credentials-get=*, publickey-credentials-create=*">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@600;700&family=Ubuntu:wght@400;500&display=swap" rel="stylesheet">

  <!-- Icon Font Stylesheet -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- OG/Twitter Meta -->
  <meta property="og:title" content="Maryland Library Management System" />
  <meta property="og:description" content="Borrow books, track your history, and more ‚Äî all in one place" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Maryland Library Management System" />
  <meta name="twitter:description" content="Borrow books, track your history, and more ‚Äî all in one place" />

  <style>
    .images { width: 100%; height: 500px; object-fit: cover; }
    .carousel-caption { background: rgba(0, 0, 0, 0.5); border-radius: 10px; padding: 20px; }
    .animated { animation-duration: 1s; animation-fill-mode: both; }
    .slideInDown { animation-name: slideInDown; }
    .zoomIn { animation-name: zoomIn; }
    .zoomOut { animation-name: zoomOut; }

    @keyframes slideInDown {
      from { transform: translate3d(0, -100%, 0); visibility: visible; }
      to { transform: translate3d(0, 0, 0); }
    }
    @keyframes zoomIn {
      from { opacity: 0; transform: scale3d(0.3, 0.3, 0.3); }
      50% { opacity: 1; }
    }
    @keyframes zoomOut {
      from { opacity: 1; }
      50% { opacity: 0; transform: scale3d(0.3, 0.3, 0.3); }
      to { opacity: 1; }
    }
  </style>
</head>

<body>
  <div id="root"></div>

   <!-- ‚úÖ Load DigitalPersona Fingerprint SDK first so it's available before React mounts -->
   <script src="/DigitalReader/Test-Client/scripts/fingerprint.sdk.min.js"></script>
   <script src="/DigitalReader/Test-Client/scripts/websdk.client.bundle.min.js"></script>

   <!-- Browser compatibility and device-specific checks -->
   <script>
     // Browser compatibility check for U.are.U 4500
     function checkBrowserCompatibility() {
       const browserInfo = {
         chrome: /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor),
         firefox: /Firefox/.test(navigator.userAgent),
         edge: /Edg/.test(navigator.userAgent),
         safari: /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent),
         ie: /MSIE|Trident/.test(navigator.userAgent)
       };

       console.log("Browser Detection:", browserInfo);

       // Check for WebUSB support (important for modern fingerprint readers)
       if ('usb' in navigator) {
         console.log("‚úÖ WebUSB API supported - good for U.are.U 4500");
       } else {
         console.warn("‚ö†Ô∏è WebUSB API not supported - may limit device access");
       }

       // Check for HTTPS (required for WebUSB in some browsers)
       if (location.protocol === 'https:') {
         console.log("‚úÖ HTTPS enabled - required for WebUSB");
       } else if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
         console.log("‚úÖ Localhost detected - WebUSB works without HTTPS");
       } else {
         console.warn("‚ö†Ô∏è HTTP detected - WebUSB requires HTTPS in production");
       }

       return browserInfo;
     }

     // Check SDK loading status
     setTimeout(() => {
       checkBrowserCompatibility();

       // Check what SDK objects are actually available
       const sdkStatus = {
         hasFingerprint: !!window.Fingerprint,
         hasFingerprintWebApi: !!window.Fingerprint?.WebApi,
         hasWebSdk: !!window.WebSdk,
         hasDPWebSDK: !!window.DPWebSDK,
         hasDigitalPersona: !!window.DigitalPersona
       };

       console.log("SDK Loading Status:", sdkStatus);

       if (!window.Fingerprint?.WebApi && !window.WebSdk && !window.DPWebSDK) {
         console.warn("‚ö†Ô∏è No compatible fingerprint SDK found");
         console.warn("üí° For U.are.U 4500 troubleshooting:");
         console.warn("   - Ensure device is properly connected to USB port");
         console.warn("   - Check Windows Device Manager for device status");
         console.warn("   - Try different USB port if available");
         console.warn("   - Restart DigitalPersona service if installed");
         console.warn("   - Verify the SDK file is loading correctly from /assets/");
       } else {
         console.log("‚úÖ SDK objects detected, proceeding with biometric component");
       }
     }, 2000); // Wait 2 seconds for primary load
   </script>

      <!-- ‚úÖ Then load your React/Vite bundle -->
   <script type="module" src="/src/main.tsx"></script>

 
  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ‚úÖ Improved DigitalPersona SDK detection with U.are.U 4500 support -->
  <script>
    window.addEventListener("load", () => {
      console.log("üîç Checking for DigitalPersona SDK (U.are.U 4500 compatible)...");
      console.log("Browser Info:", {
        userAgent: navigator.userAgent,
        https: location.protocol === 'https:',
        localhost: location.hostname === 'localhost' || location.hostname === '127.0.0.1'
      });

      // Check all possible global objects
      const checks = {
        'window.Fingerprint': window.Fingerprint,
        'window.Fingerprint.WebApi': window.Fingerprint?.WebApi,
        'window.DPWebSDK': window.DPWebSDK,
        'window.dpWebSDK': window.dpWebSDK,
        'window.DigitalPersona': window.DigitalPersona,
        'window.DPFP': window.DPFP,
        'window.WebSdk': window.WebSdk
      };

      console.log("SDK Global Objects Check:", checks);

      // Check for ActiveX (IE legacy)
      let activeXAvailable = false;
      if (window.ActiveXObject) {
        try {
          new ActiveXObject("DPFPCtl.DPFPControl");
          activeXAvailable = true;
          console.log("‚úÖ ActiveX DigitalPersona control available");
        } catch (e) {
          console.log("‚ùå ActiveX DigitalPersona control not available:", e.message);
        }
      }

      // Check for USB device access (modern browsers)
      let usbAccessGranted = false;
      if ('usb' in navigator) {
        console.log("‚úÖ WebUSB API available");
        // Note: Actual USB access requires user permission
      } else {
        console.log("‚ùå WebUSB API not available");
      }

      const sdkFound = !!(
        window.Fingerprint?.WebApi ||
        window.DPWebSDK ||
        window.dpWebSDK ||
        window.DigitalPersona ||
        window.DPFP ||
        window.WebSdk ||
        activeXAvailable
      );

      if (sdkFound) {
        console.log("%c‚úÖ SDK detected and ready", "color:green;font-weight:bold;");

        // Determine which SDK is available and log appropriately
        if (window.Fingerprint?.WebApi) {
          console.log("‚úÖ Fingerprint.WebApi is available");
          try {
            const testInstance = new window.Fingerprint.WebApi();
            console.log("‚úÖ Fingerprint.WebApi instantiation successful");
          } catch (e) {
            console.error("‚ùå Fingerprint.WebApi instantiation failed:", e);
          }
        } else if (window.WebSdk) {
          console.log("‚úÖ WebSdk is available (WebSocket-based SDK)");
        } else if (window.DPWebSDK) {
          console.log("‚úÖ DPWebSDK is available");
        } else {
          console.log("‚úÖ Alternative SDK detected");
        }

        console.log("‚ÑπÔ∏è Device enumeration will be handled by the biometric component");
      } else {
        console.warn("‚ö†Ô∏è DigitalPersona SDK not found or not properly initialized");
        console.warn("For U.are.U 4500 on Windows 10:");
        console.warn("1. ‚úÖ DigitalPersona drivers are installed");
        console.warn("2. Make sure the device is connected and powered on");
        console.warn("3. Try using Chrome or Firefox (recommended for WebUSB)");
        console.warn("4. If using HTTPS, ensure proper SSL certificate");
        console.warn("5. Check Windows Device Manager for device status");
        console.warn("6. Try refreshing the page or restarting the browser");
        console.warn("7. Check browser console for detailed error messages");
      }
    });
  </script>
</body>
</html>
